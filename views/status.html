<style>
.show {
  transition: opacity 400ms;
  display: show;
}
.hide {
  opacity: 0;
  display: none;
}

.loading {
    display: flex;
    justify-content: center;
}

/* https://dev.to/dcodeyt/how-to-create-a-css-only-loading-spinner-5fh5 */

.loading::after {
    content: "";
    width: 20px;
    height: 20px;
    border: 5px solid #dddddd;
    border-top-color: #0076d1;
    border-radius: 50%;
    animation: loading 1s ease infinite;
}

@keyframes loading {
    to {
        transform: rotate(1turn);
    }
}
</style>
<script type="text/javascript">
  function showStatus(status) {

      for (const el of document.getElementsByClassName("status")) {
          if (el.dataset["name"] == status) {
              el.classList.remove("hide")
              el.classList.add("show")
          }
          else {
              el.classList.remove("show")
              el.classList.add("hide")
          }
      }
  }

  document.addEventListener("DOMContentLoaded", function(event) { 

      const evtSource = new EventSource("/events/{{.id}}");

      evtSource.addEventListener("status", function(event) {
          if (event.data == "started") {
              showStatus("waiting")
              evtSource.onmessage = function(event) {
                  messageEvent = JSON.parse(event.data)

                  const newElement = document.createElement("li");
                  const eventList = document.getElementById("list");

                  showStatus(messageEvent.Type)
                  newElement.textContent += messageEvent.Message;
                  eventList.appendChild(newElement);
              }
          }

          if (event.data == "stopped") {
              document.getElementById("spinner").remove()
              evtSource.close();
          }
      });
  });

</script>

<div style="float: right" id="spinner" class="loading loading--full-height"></div>
<div class="hide status" data-name="waiting">‚åõ Processing</div>
<div class="hide status" data-name="convert">‚åõ Converting</div>
<div class="hide status" data-name="done">‚úÖ Scan was successful</div>
<div class="hide status" data-name="scanimage">üìÉ Scanning the document</div>
<div class="hide status" data-name="ocrmypdf">üëÄ Running OCR</div>
<div class="hide status" data-name="error">‚ùå Scan failed, please check the log</div>
<details>
  <summary>Detailed log output</summary>
  <pre id="list"></pre>
</details>
<a href="/show/{{ .id }}" class="hide status" data-name="done">{{.FullNameWithExtension}}</a>
<hr>
<a href="/scan">Back</a>
